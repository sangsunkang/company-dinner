<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÌöåÏãùÎπÑ Ï†ïÏÇ∞ Í≥ÑÏÇ∞Í∏∞</title>
    
    <!-- ÌïÑÏàò ÎùºÏù¥Î∏åÎü¨Î¶¨ (CDN) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Î™®Î∞îÏùº ÏµúÏ†ÅÌôî Î∞è ÌÑ∞ÏπòÍ∞ê Í∞úÏÑ† */
        body { -webkit-tap-highlight-color: transparent; touch-action: manipulation; background-color: #f8fafc; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        .beef-border { border-left: 4px solid #ef4444; }
        .pork-border { border-left: 4px solid #f97316; }
        .drink-border { border-left: 4px solid #3b82f6; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ÏïÑÏù¥ÏΩò Î™®Ïùå (SVG)
        const Icons = {
            Receipt: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 17V7"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Minus: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/></svg>,
            Settings: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.72V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.17a2 2 0 0 1 1-1.74l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
            RotateCcw: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        };

        const App = () => {
            // --- Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï ---
            const DEFAULT_CATEGORIES = [
                { id: 'beef', name: 'üêÇ ÏÜåÍ≥†Í∏∞', borderClass: 'beef-border', items: [
                    { id: 'b1', label: 'ÏÜå Îì±Ïã¨', price: 45000, icon: 'ü•©' },
                    { id: 'b2', label: 'ÏÜå Í∞àÎπÑÏÇ¥', price: 45000, icon: 'üçñ' },
                    { id: 'b3', label: 'ÏÜå ÏÇ¥ÏπòÏÇ¥', price: 45000, icon: 'üî•' }
                ]},
                { id: 'pork', name: 'üêñ ÎèºÏßÄÍ≥†Í∏∞', borderClass: 'pork-border', items: [
                    { id: 'p1', label: 'ÏÇºÍ≤πÏÇ¥', price: 15000, icon: 'ü•ì' }
                ]},
                { id: 'drink', name: 'üç∫ Ï£ºÎ•ò/ÏùåÎ£å', borderClass: 'drink-border', items: [
                    { id: 'd1', label: 'ÏÜåÏ£º', price: 5000, icon: 'üß™' },
                    { id: 'd2', label: 'Îß•Ï£º', price: 6000, icon: 'üç∫' }
                ]}
            ];

            // --- ÏÉÅÌÉú Í¥ÄÎ¶¨ ---
            const [categories, setCategories] = useState(() => {
                const saved = localStorage.getItem('hoesik_categories');
                return saved ? JSON.parse(saved) : DEFAULT_CATEGORIES;
            });
            const [counts, setCounts] = useState(() => {
                const saved = localStorage.getItem('hoesik_counts');
                return saved ? JSON.parse(saved) : {};
            });
            const [logs, setLogs] = useState(() => {
                const saved = localStorage.getItem('hoesik_logs');
                return saved ? JSON.parse(saved) : [];
            });
            const [peopleCount, setPeopleCount] = useState(() => {
                const saved = localStorage.getItem('hoesik_people');
                return saved ? parseInt(saved) : 1;
            });
            const [isEditMode, setIsEditMode] = useState(false);

            // --- ÏûêÎèô Ï†ÄÏû• ---
            useEffect(() => {
                localStorage.setItem('hoesik_categories', JSON.stringify(categories));
                localStorage.setItem('hoesik_counts', JSON.stringify(counts));
                localStorage.setItem('hoesik_logs', JSON.stringify(logs));
                localStorage.setItem('hoesik_people', peopleCount.toString());
            }, [categories, counts, logs, peopleCount]);

            // --- Í≥ÑÏÇ∞ Î°úÏßÅ ---
            const allItemsMap = useMemo(() => {
                const map = {};
                categories.forEach(cat => cat.items.forEach(item => { map[item.id] = item; }));
                return map;
            }, [categories]);

            const totalAmount = useMemo(() => {
                return Object.entries(counts).reduce((sum, [id, count]) => {
                    const item = allItemsMap[id];
                    return item ? sum + (item.price * count) : sum;
                }, 0);
            }, [counts, allItemsMap]);

            const perPersonAmount = peopleCount > 0 ? Math.floor(totalAmount / peopleCount) : 0;

            // --- Ìï∏Îì§Îü¨ Ìï®Ïàò ---
            const updateCount = (id, delta) => {
                const current = counts[id] || 0;
                if (current + delta < 0) return;
                
                const nextCounts = { ...counts, [id]: current + delta };
                setCounts(nextCounts);
                
                const item = allItemsMap[id];
                if (item) {
                    const now = new Date();
                    const timeStr = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                    setLogs(prev => [{ id: Date.now(), name: item.label, delta, time: timeStr }, ...prev].slice(0, 20));
                }
            };

            const handleReset = () => {
                if (confirm('Ï†ÑÏ≤¥ Ï£ºÎ¨∏ ÎÇ¥Ïó≠ÏùÑ Ï¥àÍ∏∞ÌôîÌï†ÍπåÏöî?')) {
                    setCounts({});
                    setLogs([]);
                    setPeopleCount(1);
                }
            };

            const handleUpdateItem = (catId, itemId, field, value) => {
                setCategories(prev => prev.map(cat => {
                    if (cat.id !== catId) return cat;
                    return { ...cat, items: cat.items.map(item => {
                        if (item.id !== itemId) return item;
                        return { ...item, [field]: field === 'price' ? parseInt(value) || 0 : value };
                    })};
                }));
            };

            const handleAddItem = (catId) => {
                const newItem = { id: 'item-' + Date.now(), label: 'ÏÉà Î©îÎâ¥', price: 10000, icon: 'üçΩÔ∏è' };
                setCategories(prev => prev.map(cat => {
                    if (cat.id !== catId) return cat;
                    return { ...cat, items: [...cat.items, newItem] };
                }));
            };

            const handleDeleteItem = (catId, itemId) => {
                if (!confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
                setCategories(prev => prev.map(cat => {
                    if (cat.id !== catId) return cat;
                    return { ...cat, items: cat.items.filter(i => i.id !== itemId) };
                }));
                setCounts(prev => { const n = {...prev}; delete n[itemId]; return n; });
            };

            // --- UI Î†åÎçîÎßÅ ---
            return (
                <div className="max-w-md mx-auto min-h-screen pb-10">
                    {/* Ìó§Îçî */}
                    <div className="sticky top-0 z-30 bg-white shadow-sm border-b border-slate-200">
                        <div className="bg-slate-900 px-4 py-3 flex justify-between items-center text-white">
                            <div className="flex items-center gap-2 font-bold text-sm">
                                <Icons.Receipt /> {isEditMode ? 'Î©îÎâ¥Ìåê Ìé∏Ïßë' : 'ÌöåÏãù Ï†ïÏÇ∞Í∏∞'}
                            </div>
                            <div className="flex gap-1">
                                {!isEditMode && <button onClick={handleReset} className="p-2 text-slate-400"><Icons.RotateCcw /></button>}
                                <button onClick={() => setIsEditMode(!isEditMode)} className={`p-2 rounded-full ${isEditMode ? 'bg-green-500 text-white' : 'text-slate-400'}`}>
                                    {isEditMode ? <Icons.Check /> : <Icons.Settings />}
                                </button>
                            </div>
                        </div>
                        <div className="p-6 text-center">
                            <span className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Total Bill</span>
                            <div className="text-4xl font-black text-slate-800 mt-1">
                                {totalAmount.toLocaleString()}Ïõê
                            </div>
                        </div>
                    </div>

                    <div className="p-4 space-y-6">
                        {categories.map(cat => (
                            <section key={cat.id} className="animate-fadeIn">
                                <div className="flex justify-between items-center mb-3 px-1">
                                    <h2 className="text-[11px] font-black text-slate-400 uppercase tracking-widest">{cat.name}</h2>
                                    {isEditMode && <button onClick={() => handleAddItem(cat.id)} className="text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded-full">+ Ï∂îÍ∞Ä</button>}
                                </div>
                                <div className="space-y-2">
                                    {cat.items.map(item => (
                                        <div key={item.id} className={`bg-white rounded-2xl shadow-sm border border-slate-200 transition-all ${cat.borderClass} ${isEditMode ? 'p-3' : 'p-4 flex items-center justify-between'}`}>
                                            {isEditMode ? (
                                                <div className="w-full space-y-2">
                                                    <div className="flex items-center gap-2">
                                                        <input className="w-8 text-center bg-slate-50 border rounded p-1 text-sm" value={item.icon} onChange={e => handleUpdateItem(cat.id, item.id, 'icon', e.target.value)} />
                                                        <input className="flex-1 bg-slate-50 border rounded px-2 py-1 text-sm font-bold" value={item.label} onChange={e => handleUpdateItem(cat.id, item.id, 'label', e.target.value)} />
                                                        <button onClick={() => handleDeleteItem(cat.id, item.id)} className="p-2 text-red-300"><Icons.Trash /></button>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <span className="text-[10px] font-bold text-slate-300 w-8">KRW</span>
                                                        <input type="number" className="flex-1 bg-slate-50 border rounded px-2 py-1 text-sm font-mono" value={item.price} onChange={e => handleUpdateItem(cat.id, item.id, 'price', e.target.value)} />
                                                    </div>
                                                </div>
                                            ) : (
                                                <>
                                                    <div className="flex items-center gap-4">
                                                        <div className="text-2xl">{item.icon}</div>
                                                        <div>
                                                            <div className="font-bold text-slate-800 text-sm leading-none mb-1">{item.label}</div>
                                                            <div className="text-slate-400 text-[11px]">{item.price.toLocaleString()}Ïõê</div>
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center gap-2 bg-slate-100 rounded-xl p-1">
                                                        <button onClick={() => updateCount(item.id, -1)} disabled={!counts[item.id]} className={`w-9 h-9 rounded-lg flex items-center justify-center transition-all ${!counts[item.id] ? 'text-slate-300' : 'bg-white text-rose-500 shadow-sm active:scale-90'}`}><Icons.Minus /></button>
                                                        <span className={`w-6 text-center font-black text-sm ${counts[item.id] ? 'text-slate-900' : 'text-slate-300'}`}>{counts[item.id] || 0}</span>
                                                        <button onClick={() => updateCount(item.id, 1)} className="w-9 h-9 bg-white text-blue-600 rounded-lg shadow-sm flex items-center justify-center active:scale-90 transition-all"><Icons.Plus /></button>
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </section>
                        ))}

                        {!isEditMode && (
                            <div className="space-y-4 pt-4">
                                {/* NÎπµ Ï†ïÏÇ∞ */}
                                <div className="bg-indigo-600 rounded-3xl shadow-lg p-6 text-white">
                                    <div className="flex justify-between items-center mb-6">
                                        <div className="text-[10px] font-bold opacity-60 uppercase">Guests</div>
                                        <div className="flex items-center gap-4">
                                            <button onClick={() => setPeopleCount(p => Math.max(1, p - 1))} className="w-8 h-8 rounded-lg bg-white/20 flex items-center justify-center"><Icons.Minus /></button>
                                            <span className="text-xl font-black w-6 text-center">{peopleCount}</span>
                                            <button onClick={() => setPeopleCount(p => p + 1)} className="w-8 h-8 rounded-lg bg-white/20 flex items-center justify-center"><Icons.Plus /></button>
                                        </div>
                                    </div>
                                    <div className="flex justify-between items-end border-t border-white/10 pt-4">
                                        <div className="text-[10px] font-bold opacity-60 uppercase">Per Person</div>
                                        <div className="text-2xl font-black">{perPersonAmount.toLocaleString()}Ïõê</div>
                                    </div>
                                </div>

                                {/* Î°úÍ∑∏ */}
                                <div className="bg-white rounded-3xl shadow-sm p-5 border border-slate-200">
                                    <h3 className="text-[10px] font-black text-slate-300 uppercase tracking-widest mb-4 flex items-center gap-2">Timeline</h3>
                                    <div className="space-y-3 max-h-40 overflow-y-auto custom-scrollbar">
                                        {logs.length === 0 ? <div className="text-center py-6 text-slate-200 text-xs italic font-medium">Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</div> : 
                                            logs.map(log => (
                                                <div key={log.id} className="flex justify-between items-center animate-fadeIn">
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-[9px] font-mono text-slate-400 bg-slate-50 px-1.5 py-0.5 rounded">{log.time}</span>
                                                        <span className="text-xs font-bold text-slate-600">{log.name}</span>
                                                    </div>
                                                    <span className={`text-[10px] font-black px-2 py-0.5 rounded-full ${log.delta > 0 ? 'bg-blue-50 text-blue-600' : 'bg-rose-50 text-rose-600'}`}>{log.delta > 0 ? '+ 1' : 'Ï∑®ÏÜå'}</span>
                                                </div>
                                            ))
                                        }
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
