<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전기 실무 계산기 Pro</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-[#f8fafc]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // 아이콘 컴포넌트 래퍼 (Lucide 대응)
        const Icon = ({ name, size = 22, className = "" }) => {
            useEffect(() => {
                lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const Card = ({ title, iconName, children, result, resultLabel = "판정 결과", unit = "", subResult, formula, colorClass="text-blue-600", bgClass="bg-blue-50" }) => (
            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-5 flex flex-col h-full hover:shadow-md transition-all duration-300">
                <div className="flex items-center gap-3 mb-5 text-slate-700">
                    <div className={`p-2.5 ${bgClass} ${colorClass} rounded-xl shadow-sm flex items-center justify-center`}>
                        <Icon name={iconName} size={22} />
                    </div>
                    <h3 className="font-bold text-lg tracking-tight leading-tight">{title}</h3>
                </div>
                <div className="flex-grow space-y-4">
                    {children}
                </div>
                <div className="mt-6 pt-5 border-t border-slate-100">
                    <div className="text-[11px] font-bold text-slate-400 uppercase tracking-widest mb-1.5">{resultLabel}</div>
                    <div className="flex items-baseline gap-1.5 flex-wrap">
                        <span className={`text-3xl font-black tracking-tighter ${colorClass}`}>
                            {result}
                        </span>
                        <span className="text-sm font-bold text-slate-400">{unit}</span>
                    </div>
                    {formula && (
                        <div className="text-[10px] font-mono text-slate-400 mt-1 italic">
                            Formula: {formula}
                        </div>
                    )}
                    {subResult && (
                        <div className="mt-3 text-[12px] leading-relaxed text-slate-600 bg-slate-50 p-3 rounded-lg border border-slate-100 flex items-start gap-2">
                            <Icon name="info" size={14} className="mt-0.5 flex-shrink-0 text-slate-400" />
                            <span>{subResult}</span>
                        </div>
                    )}
                </div>
            </div>
        );

        const InputGroup = ({ label, value, onChange, placeholder, unit, step = "1", type="number" }) => (
            <div className="w-full">
                <label className="block text-[11px] font-bold text-slate-500 mb-1.5 ml-1 uppercase tracking-wider">{label}</label>
                <div className="relative group">
                    <input
                        type={type}
                        value={value}
                        onChange={(e) => onChange(e.target.value)}
                        step={step}
                        className="block w-full rounded-xl border-slate-200 bg-slate-50 border-2 focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 text-sm font-semibold p-3 pr-12 transition-all outline-none"
                        placeholder={placeholder}
                    />
                    <div className="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                        <span className="text-slate-400 font-bold text-[10px]">{unit}</span>
                    </div>
                </div>
            </div>
        );

        const PhaseSelector = ({ phase, setPhase, label1 = "단상", label3 = "3상" }) => (
            <div className="flex bg-slate-100 p-1.5 rounded-xl mb-4">
                <button onClick={() => setPhase(1)} className={`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${phase === 1 ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>{label1}</button>
                <button onClick={() => setPhase(3)} className={`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${phase === 3 ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>{label3}</button>
            </div>
        );

        const UnitSelector = ({ unit, setUnit }) => (
            <div className="flex bg-slate-100 p-1.5 rounded-xl mb-4 w-full">
                <button onClick={() => setUnit('kW')} className={`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${unit === 'kW' ? 'bg-white text-emerald-600 shadow-sm' : 'text-slate-500'}`}>kW</button>
                <button onClick={() => setUnit('HP')} className={`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${unit === 'HP' ? 'bg-white text-emerald-600 shadow-sm' : 'text-slate-500'}`}>HP</button>
            </div>
        );

        function App() {
            // States
            const [motorPhase, setMotorPhase] = useState(3);
            const [motorUnit, setMotorUnit] = useState('kW');
            const [motorCap, setMotorCap] = useState(15);
            const [motorV, setMotorV] = useState(380);
            const [motorEff, setMotorEff] = useState(0.9);
            const [motorPf, setMotorPf] = useState(0.85);

            const [powerPhase, setPowerPhase] = useState(1);
            const [powerV, setPowerV] = useState(220);
            const [powerI, setPowerI] = useState(15);
            const [powerIR, setPowerIR] = useState(10);
            const [powerIS, setPowerIS] = useState(20);
            const [powerIT, setPowerIT] = useState(30);

            const [currPhase, setCurrPhase] = useState(1);
            const [currP, setCurrP] = useState(3300);
            const [currV, setCurrV] = useState(220);

            const [ubR, setUbR] = useState(10);
            const [ubS, setUbS] = useState(20);
            const [ubT, setUbT] = useState(30);

            const [leakSupply, setLeakSupply] = useState(50);
            const [leakMeasured, setLeakMeasured] = useState(0.1);

            const [pfLoad, setPfLoad] = useState(100);
            const [pfBefore, setPfBefore] = useState(0.8);
            const [pfAfter, setPfAfter] = useState(0.95);

            const [trCap, setTrCap] = useState(500);
            const [trV, setTrV] = useState(6600);

            // Calculations
            const motorCurrent = () => {
                let watts = motorCap * 1000;
                if (motorUnit === 'HP') watts = motorCap * 745.7;
                const den = motorPhase === 3 ? Math.sqrt(3) * motorV * motorEff * motorPf : motorV * motorEff * motorPf;
                return (watts / den).toFixed(2);
            };

            const unbalance = () => {
                const avg = (parseFloat(ubR) + parseFloat(ubS) + parseFloat(ubT)) / 3;
                if (avg === 0) return "0.0";
                const maxDiff = Math.max(Math.abs(ubR - avg), Math.abs(ubS - avg), Math.abs(ubT - avg));
                return ((maxDiff / avg) * 100).toFixed(1);
            };

            return (
                <div className="max-w-7xl mx-auto p-4 md:p-8">
                    <header className="mb-10 flex flex-col md:flex-row md:items-end justify-between border-b border-slate-200 pb-8">
                        <div>
                            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-50 text-blue-600 text-[10px] font-black uppercase tracking-widest mb-3 border border-blue-100">
                                Electrical Tools Pro
                            </div>
                            <h1 className="text-2xl font-black text-slate-900 flex items-center gap-3 tracking-tight">
                                <Icon name="calculator" size={30} className="text-blue-600" />
                                전기 실무 계산기 <span className="text-blue-600">Pro</span>
                            </h1>
                        </div>
                        <div className="mt-4 md:mt-0 text-right font-bold text-[10px] text-slate-400 uppercase tracking-widest">
                            GITHUB DEPLOY VERSION 3.2
                        </div>
                    </header>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <Card 
                            title="모터 정격전류 (정밀)" iconName="settings" 
                            result={motorCurrent()} unit="A" formula={motorPhase === 3 ? "P / (√3 * V * η * cosΘ)" : "P / (V * η * cosΘ)"}
                            colorClass="text-emerald-600" bgClass="bg-emerald-50"
                        >
                            <PhaseSelector phase={motorPhase} setPhase={setMotorPhase} />
                            <UnitSelector unit={motorUnit} setUnit={setMotorUnit} />
                            <div className="grid grid-cols-2 gap-3">
                                <InputGroup label="용량" value={motorCap} onChange={setMotorCap} unit={motorUnit} />
                                <InputGroup label="전압" value={motorV} onChange={setMotorV} unit="V" />
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <InputGroup label="효율" value={motorEff} onChange={setMotorEff} unit="η" step="0.01" />
                                <InputGroup label="역률" value={motorPf} onChange={setMotorPf} unit="cos" step="0.01" />
                            </div>
                        </Card>

                        <Card 
                            title="전력 계산 (P)" iconName="zap" 
                            result={powerPhase === 1 ? (powerV * powerI).toLocaleString() : (powerV * (parseFloat(powerIR)+parseFloat(powerIS)+parseFloat(powerIT))).toLocaleString()} 
                            unit="W" formula={powerPhase === 1 ? "V * I" : "V_phase * ΣI_phase"}
                        >
                            <PhaseSelector phase={powerPhase} setPhase={setPowerPhase} label3="3상 4선식" />
                            {powerPhase === 1 ? (
                                <div className="grid grid-cols-2 gap-3">
                                    <InputGroup label="전압" value={powerV} onChange={setPowerV} unit="V" />
                                    <InputGroup label="전류" value={powerI} onChange={setPowerI} unit="A" />
                                </div>
                            ) : (
                                <div className="space-y-3">
                                    <InputGroup label="상전압" value={powerV} onChange={setPowerV} unit="V" />
                                    <div className="grid grid-cols-3 gap-2">
                                        <InputGroup label="R상" value={powerIR} onChange={setPowerIR} unit="A" />
                                        <InputGroup label="S상" value={powerIS} onChange={setPowerIS} unit="A" />
                                        <InputGroup label="T상" value={powerIT} onChange={setPowerIT} unit="A" />
                                    </div>
                                </div>
                            )}
                        </Card>

                        <Card 
                            title="부하 전류 (I)" iconName="activity" 
                            result={currPhase === 1 ? (currP / currV).toFixed(2) : (currP / (Math.sqrt(3) * currV)).toFixed(2)} 
                            unit="A" formula={currPhase === 1 ? "P / V" : "P / (√3 * V)"}
                            colorClass="text-indigo-600" bgClass="bg-indigo-50"
                        >
                            <PhaseSelector phase={currPhase} setPhase={setCurrPhase} />
                            <div className="grid grid-cols-2 gap-3">
                                <InputGroup label="전력" value={currP} onChange={setCurrP} unit="W" />
                                <InputGroup label="전압" value={currV} onChange={setCurrV} unit="V" />
                            </div>
                        </Card>

                        <Card 
                            title="3상 불평형률" iconName="scale" 
                            result={unbalance()} unit="%" formula="(MaxDiff / Avg) * 100"
                            subResult={unbalance() > 30 ? "⚠️ 불량 (상 평형 조정 필요)" : "✅ 양호 (30% 이하)"}
                            colorClass={unbalance() > 30 ? "text-red-600" : "text-blue-600"}
                            bgClass={unbalance() > 30 ? "bg-red-50" : "bg-blue-50"}
                        >
                            <div className="grid grid-cols-3 gap-2">
                                <InputGroup label="R (A)" value={ubR} onChange={setUbR} unit="A" />
                                <InputGroup label="S (A)" value={ubS} onChange={setUbS} unit="A" />
                                <InputGroup label="T (A)" value={ubT} onChange={setUbT} unit="A" />
                            </div>
                        </Card>

                        <Card 
                            title="누설전류 판정" iconName="shield-alert" 
                            result={leakMeasured <= (leakSupply/2000*1000) ? "적합" : "부적합"}
                            formula="I_rated / 2000"
                            subResult={`KEC 기준 한계: ${(leakSupply/2000*1000).toFixed(2)} mA`}
                            colorClass={leakMeasured <= (leakSupply/2000*1000) ? "text-blue-600" : "text-red-600"}
                            bgClass={leakMeasured <= (leakSupply/2000*1000) ? "bg-blue-50" : "bg-red-50"}
                        >
                            <div className="grid grid-cols-2 gap-3">
                                <InputGroup label="정격전류" value={leakSupply} onChange={setLeakSupply} unit="A" />
                                <InputGroup label="측정누설" value={leakMeasured} onChange={setLeakMeasured} unit="mA" step="0.01" />
                            </div>
                        </Card>

                        <Card 
                            title="콘덴서 용량" iconName="battery-charging" 
                            result={(pfLoad * (Math.sqrt(1/(pfBefore*pfBefore)-1) - Math.sqrt(1/(pfAfter*pfAfter)-1))).toFixed(2)} 
                            unit="kVAR" formula="P * (tanΘ1 - tanΘ2)"
                            colorClass="text-cyan-600" bgClass="bg-cyan-50"
                        >
                            <InputGroup label="유효전력" value={pfLoad} onChange={setPfLoad} unit="kW" />
                            <div className="grid grid-cols-2 gap-3">
                                <InputGroup label="현재역률" value={pfBefore} onChange={setPfBefore} unit="cos" step="0.01" />
                                <InputGroup label="목표역률" value={pfAfter} onChange={setPfAfter} unit="cos" step="0.01" />
                            </div>
                        </Card>

                        <Card 
                            title="변압기 정격" iconName="disc" 
                            result={trV > 0 ? ((trCap * 1000) / (Math.sqrt(3) * trV)).toFixed(2) : 0} 
                            unit="A" formula="S / (√3 * V)"
                            colorClass="text-purple-600" bgClass="bg-purple-50"
                        >
                            <div className="grid grid-cols-1 gap-3">
                                <InputGroup label="용량" value={trCap} onChange={setTrCap} unit="kVA" />
                                <InputGroup label="전압" value={trV} onChange={setTrV} unit="V" />
                            </div>
                        </Card>
                    </div>
                    
                    <footer className="mt-16 text-center text-slate-400 text-[10px] pb-12 border-t border-slate-200 pt-10">
                        <p>본 계산기는 교육 및 참고용이며, 실제 시공 시 KEC 법규를 반드시 재확인하십시오.</p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

